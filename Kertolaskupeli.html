<!DOCTYPE html>
<html lang="fi">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="ulkoasu.css">
        <title>Kertolaskupeli</title>
    </head>
    
    <body onload="alusta();">
        

        <h1>Kertolaskupeli</h1>
        <form>
            <div id="lasku">Kertolasku</div>
            
            <input onsubmit="laskevastaus(document.getElementById('vastaus').value)
            " type="text" id="vastaus" 
            placeholder="Syötä luku 1-100 väliltä." autocomplete="off">
            <div id="oikeinvaarin"></div>
            
     
            <button id="nappi" class="button" type="button" onclick=
            "laskevastaus(document.getElementById('vastaus').
            value)">Tarkista</button>

            <div id="pisteet">pisteet</div>
            <label for="tallennus">tallennus: </label>
            <input id="tallennus" type="checkbox" name="tallennus" class="checkmark" onchange="tallennusfunktio();"> 
        </form>
        
        <script>
            "use strict";
            let tulos = 0;
            let tehtlkm = localStorage.getItem('tehtlkmr');
            let oikeatlkm = localStorage.getItem('oikeat');


            function laskevastaus(pelaajan_vastaus) {
                if (pelaajan_vastaus > 0 && pelaajan_vastaus < 100) {
                    if (pelaajan_vastaus == tulos) {
                        document.getElementById("oikeinvaarin").innerHTML = "Oikein! " 
                        oikeatlkm ++;     
                    } else{
                        document.getElementById("oikeinvaarin").innerHTML =
                         "Väärin! " + "oikea vastaus olisi ollut: " + tulos    
                    }
                    tehtlkm ++;
                    alusta()
                } else {
                    document.getElementById('oikeinvaarin').innerHTML =
                     "Anna luku 1 - 100 väiltä!"
                }
            }

            function alusta() {
               let kertoja = luonumero();
               let kerrottava = luonumero();
                document.getElementById('lasku').innerHTML = "<p>"+ kertoja + " X " + kerrottava +"</p>"
                tulos = kertoja * kerrottava;
                document.getElementById('vastaus').value = ""

                //Irroitettu pisteiden alustus erilliseksi funktioksi

                tallennusfunktio();
                
                
           }
            function tallennusfunktio() {
                if (document.getElementById('tallennus').checked == true) {
                    localStorage.setItem('oikeat',oikeatlkm);
                    localStorage.setItem('tehtlkmr',tehtlkm);
                } else {
                    localStorage.clear();
                    tehtlkm = 0;
                    oikeatlkm = 0;
                }
                paivitaPisteetLocalStoragesta();
                PisteTilastonMuutos();
            }

            function luonumero() {
                let numero = Math.floor(Math.random() * 10) + 1;
                return numero
            }

            function paivitaPisteetLocalStoragesta() {
                if (tehtlkm != null) {
                    parseInt(tehtlkm);
                    
                } else {
                    tehtlkm = 0;
                }
                if (oikeatlkm != null) {
                    parseInt(oikeatlkm);
                } else {
                    oikeatlkm = 0;
                }
            }
            function PisteTilastonMuutos() {
                if ((document.getElementById('tallennus').checked == true)) {
                    document.getElementById('pisteet').innerHTML = "Tehtäviä yhteensä: " + tehtlkm + " Joista oikein: " + oikeatlkm ;
                } else {
                    document.getElementById('pisteet').innerHTML = "Pistelaskenta ei ole käytössä. ";
                }
            }

            // tämä varmaan menee puoliksi tuonne jonnekkin html:n sekaan, ja loput omaksi funktioksi tms?
            
            var input = document.getElementById("vastaus");
            input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById("nappi").click();
            }
            });
        </script> 
    </body>
</html>